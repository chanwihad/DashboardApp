@{
    ViewData["Title"] = "Forgot Password";
}

<div class="forgot-password-container">
    <div class="forgot-password-card">
        <h1>Reset your password</h1>

        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger">@TempData["Error"]</div>
        }

        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success">@TempData["Success"]</div>
        } 
        
        @if (TempData["Success"] == null && TempData["Valid"] == null)
        {
            <form method="post" action="/Auth/SendVerificationCode">
                <div class="form-group">
                    <label for="email">Enter your email address</label>
                    <div class="input-group">
                        <input type="email" id="Email" name="Email" placeholder="Enter your email" />
                        <button type="submit" class="btn-send">Send</button>
                    </div>
                    <small>Enter the email address you used during registration. We'll send a verification code.</small>
                </div>
            </form>
        }

        @{
            bool isDisabled = TempData["Success"] == null;
            string mail = TempData["Mail"]?.ToString() ?? string.Empty;
        }
        @if (TempData["Success"] != null && TempData["Valid"] == null)
        {
            <form method="post" action="/Auth/VerifyCode">
                <input type="hidden" name="Email" value="@mail" />

                <div class="form-group">
                    <label for="Code">Verification code</label>
                    <div class="input-group">
                        <input type="text" id="Code" name="Code" placeholder="Verification code" 
                            @(isDisabled ? "disabled" : "") required/>
                        <button type="submit" class="btn-verify" @(isDisabled ? "disabled" : "")>Verify</button>
                    </div>
                </div>
            </form>
        }

        @{
            bool isValidDisabled = TempData["Valid"] == null;
        }
        @if (TempData["Valid"] != null)
        {
            <form method="post" action="/Auth/ResetPassword">
                <input type="hidden" name="Email" value="@TempData["ValidEmail"]" />

                <div class="form-group">
                    <label for="Password">New Password</label>
                    <div class="input-group">
                        <input type="password" id="Password" name="Password" placeholder="Password" 
                            @(isValidDisabled ? "disabled" : "") required/>
                        <input type="password" id="ConfirmPassword" name="ConfirmPassword" placeholder="Confirm Password" 
                            @(isValidDisabled ? "disabled" : "") required/>
                        <button class="mt-2" type="submit" class="btn-verify" @(isValidDisabled ? "disabled" : "")>Confirm</button>
                    </div>
                </div>
            </form>
        }


        <a href="/Auth/Login" type="button" class="btn btn-back">Back to Login</a>
    </div>
</div>
